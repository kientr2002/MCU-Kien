/*
 * fsm_button.c
 *
 *  Created on: Nov 15, 2022
 *      Author: ADMIN
 */
#include <fsm_automatic.h>
#include "software_timer.h"

void fsm_mode_run(){
	switch(status_mode){
	case MODE1:

		if(isbutton1pressed() == 1){
			status_mode = MODE2;
			convert_flag = 0;
			timer2_flag = 1;
		}
		break;
	case MODE2:
		if(isbutton1pressed() == 1){
			status_mode = MODE3;
			convert_flag = 0;
			timer3_flag = 1;
		}
		break;
	case MODE3:
		if(isbutton1pressed() == 1){
			status_mode = MODE4;
			convert_flag = 0;
			timer4_flag = 1;
		}
		break;
	case MODE4:
		if(isbutton1pressed() == 1){
			status_mode = MODE1;
			convert_flag = 0;
			timer1_flag = 1;
		}
		break;
	default:
		break;
	}
}

void fsm_button_run(){
	if(isbutton2pressed() == 1){
		if(status_mode == MODE2){
			if(status_horizontal == RED){
				led_buffer[1]++;
				if(led_buffer[1] > MAX_RED){
					MAX_RED = led_buffer[1];
				}
			} else if (status_vertical == RED){
				led_buffer[3]++;
				if(led_buffer[3] > MAX_RED){
					MAX_RED = led_buffer[3];
				}
			} else {
				MAX_RED++;
			}
		} else if (status_mode == MODE3){
			if(status_horizontal == YELLOW){
				led_buffer[1]++;
				if(led_buffer[1] > MAX_YELLOW){
					MAX_YELLOW = led_buffer[1];
				}
			} else if (status_vertical == YELLOW){
				led_buffer[3]++;
				if(led_buffer[3] > MAX_YELLOW){
					MAX_YELLOW = led_buffer[3];
				}
			} else {
				MAX_YELLOW++;
			}
		} else {
			if(status_horizontal == GREEN){
				led_buffer[1]++;
				if(led_buffer[1] > MAX_GREEN){
					MAX_GREEN = led_buffer[1];
				}
			} else if (status_vertical == GREEN){
				led_buffer[3]++;
				if(led_buffer[3] > MAX_GREEN){
					MAX_GREEN = led_buffer[3];
				}
			} else {
				MAX_GREEN++;
			}
		}
	}
	if(isbutton3pressed() == 1){
		status_mode = MODE1;
		convert_flag = 0;
		timer1_flag = 1;
	}
}
